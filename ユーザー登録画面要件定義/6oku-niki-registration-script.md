# 6億ニキ ツール共通 ユーザー登録画面 実装スクリプト

以下の仕様でユーザー登録画面を実装してください。

---

## 【登録フォーム】

- **年齢（必須）**: ドロップダウン
  - 選択肢: 10歳以下 / 11〜20歳 / 21〜30歳 / 31〜40歳 / 41〜50歳 / 51〜60歳 / 61〜70歳 / 70歳以上

- **性別（任意）**: ドロップダウン
  - 選択肢: 男性 / 女性 / その他 / 回答しない

- **メールアドレス（必須）**: テキスト入力
  - 形式バリデーション付き

---

## 【免責事項・利用規約の表示】

### 表示順序と構成

**1. エンタメ免責（最初に表示）**

```
■ 免責事項
本ツールはエンターテインメント目的で提供しています。
表示される結果はあくまで参考情報であり、正確性・有用性について保証するものではありません。
本ツールの利用により生じた損害について、当方は一切の責任を負いかねます。
```

**2. 利用規約（スクロールエリア内に表示）**

以下の内容を **高さ200px程度のスクロール可能なボックス** に収めてください。

```
■ 利用規約

第1条（適用および定義）
当方が提供するメールマガジン配信サービス（以下「本サービス」といいます）の利用について、本利用規約（以下「本規約」といいます）を定めます。ユーザーは、本規約に同意の上で本サービスを利用するものとします。

本サービスとは、当方がウェブサイト上でユーザー登録を行った方に対し、電子メールで各種情報を提供するサービスを指します。
ユーザーとは、本サービスに必要な情報を当方ウェブサイト上の登録フォーム等に入力し、登録を完了した個人または法人を指します。
本規約に定めのない事項については、関連法令および当方が別途定める利用規約やポリシーの定めに従うものとします。

第2条（登録と利用開始）
本サービスの利用を希望する方は、当方所定の方法（ウェブ上の登録フォーム等）により、自らの意思でメールマガジンの登録手続きを行うものとします。登録希望者は正確かつ最新の情報（メールアドレス等）を入力し、本規約に同意の上で登録を申請するものとします。未成年の方が登録する場合は、事前に親権者等法定代理人の同意を得た上で登録してください。

当方は、所定の登録手続きを完了した申請者からの登録を承諾し、ユーザーとしてメールマガジンの配信を開始します。ただし、当方は、申請者が以下のいずれかに該当する場合、登録を承諾しないことがあります。
・登録申請内容に虚偽、誤記または記入漏れがあった場合
・過去に本サービスの利用規約違反等により登録抹消等の処分を受けていることが判明した場合
・その他、当方が登録を不適当と判断した場合

第3条（ユーザー情報の管理と個人情報の取り扱い）
ユーザーが登録したメールアドレスその他の個人情報は、当方の定めるプライバシーポリシーおよび関連法令に従い適切に取り扱い、厳重に管理します。当方は、ユーザーから事前の同意を得ることなく、登録された個人情報を本サービス提供目的以外に利用せず、また法令に基づく場合を除き第三者に提供しません。

当方は、ユーザーの承諾なしに登録情報の修正・変更を行いません。ユーザーは、登録内容（メールアドレス等）に変更が生じた場合、自身で登録情報の変更手続きを行うものとします。ただし、メールアドレスの変更についてはシステム上直接の変更ができないため、変更を希望する場合は一度登録解除（配信停止）を行った上で、新しいメールアドレスにて再度登録手続きを行ってください。

ユーザーが登録手続きの際にIDやパスワード等を設定した場合、その管理責任はユーザー本人が負うものとします。当方は、ユーザーのID・パスワードの不正利用等から生じた損害について、一切の責任を負いません。

第4条（メールマガジンの配信内容・頻度）
当方は、ユーザーに対し、メールマガジンとしてオールジャンルの各種情報を電子メールで配信します。配信されるメールには、当方または提携先の商品・サービスに関する情報、キャンペーンの案内、ニュースや記事、その他運営上必要な連絡事項などが含まれる場合があります。メールマガジンは原則無料で提供され、配信頻度や内容は当方の裁量で決定します。

ユーザーは、本サービスの配信停止を希望する場合、当方が指定する所定の方法（配信メール内の購読解除リンクのクリック、又は当方ウェブサイト上の解除フォーム送信等）により、いつでも登録を解除することができます。解除手続きが完了した後、当方は速やかに当該ユーザーへのメール配信を停止し、当方の保有データから当該ユーザーのメールアドレス等を削除します。ただし、システムの都合上、配信停止の反映に数日要する場合があり、その間にメールが送信されることがあります。

第5条（当方による登録解除・サービス提供の終了）
当方は、ユーザーが以下のいずれかに該当すると認めた場合、事前の通知や承諾を要せずに当該ユーザーの登録を解除し、本サービスの利用を停止することができます。当方はこの判断に関する理由を開示する義務を負いません。
・ユーザーが本規約のいずれかの条項に違反した場合
・登録されたメールアドレスが無効状態であると当方が判断した場合（長期間未使用である、メール配信が連続してエラーとなる等）
・他人になりすまして登録を行ったことが判明した場合
・不正に入手または自動生成された多数のメールアドレスを登録したと当方が判断した場合
・その他、ユーザーとして不適切な行為があった場合、またはユーザーとして継続することが不適当であると当方が判断した場合

当方は、ユーザーへの事前の通知なく、本サービスの全部または一部の提供を中止もしくは終了することができます。天災地変その他の不可抗力、システム保守や障害等により本サービスの提供が困難と当方が判断した場合、当方は一時的にサービス提供を停止することがあります。当方による本サービスの中止・終了に伴いユーザーに生じた損害について、当方は一切責任を負わないものとします。

第6条（禁止事項）
ユーザーは、本サービスの利用にあたり以下の行為を行ってはならないものとします。これらの禁止事項に違反した場合、当方は当該ユーザーへの本サービス提供を直ちに停止し、必要に応じて法的措置を講じる権利を有します。
・他人のメールアドレスを、その所有者の承諾なしに無断で本サービスに登録する行為
・虚偽の情報や他人の情報を用いて本サービスに登録する行為
・入手または生成した多数のメールアドレスを用い、意図的に大量の登録を行う行為
・当方または第三者の著作権・商標権等の知的財産権を侵害する行為、または侵害のおそれのある行為
・本サービスを通じて提供される内容を当方の承諾なく転載・転用・営利目的で利用する行為
・本サービスの運営を妨害する行為、当方のシステムに不正にアクセスしまたは過度な負担をかける行為
・法令または公序良俗に反する行為、その他当方が不適切と判断する行為

第7条（知的財産権）
本サービスにおいて当方が配信するメールマガジンの内容（文章、画像、映像、音声等すべてのコンテンツ）に関する著作権・商標権・その他の知的財産権および肖像権・パブリシティ権等は、当方または正当な権利者に帰属します。ユーザーは、当方および権利者の許可なく、本サービスで提供されるコンテンツを複製、転載、改変、頒布、公衆送信等の方法で利用してはなりません。万一ユーザーが本条に違反して第三者との間で問題が生じた場合、ユーザー自身の費用と責任においてその問題を解決するとともに、当方に一切の損害を与えないものとします。

第8条（免責事項）
当方は、本サービスにおいて提供する情報について、その正確性・有用性・最新性等に関していかなる保証も行いません。ユーザーは自己の判断と責任において本サービスの情報を利用するものとし、本サービスの利用または利用不能により生じた一切の損害について、当方は故意または重大な過失がない限り責任を負いません。

当方は、メールマガジンが確実に配信されること、および配信に遅延や不具合が生じないことを保証しません。本サービスの配信遅延・中断・停止、メールの不達・誤配等に起因してユーザーに生じた損害について、当方は一切の責任を負わないものとします。また、ユーザーが本サービスを利用するにあたり発生する通信費用等はユーザー負担とし、当方は負担いたしません。

ユーザーが本サービスを通じて取得した情報に基づき当方または第三者の商品・サービスを利用したことにより生じたトラブルや損害について、当方は一切責任を負いません（当方に故意または重大な過失がある場合を除きます）。

本規約に別途定める場合のほか、当方は本サービスに関連してユーザーに生じた一切の損害について、法律上許容される最大限の範囲で責任を免れるものとします。

第9条（規約の変更）
当方は、必要に応じて本規約を変更することができます。規約を変更する場合、変更後の規約の施行日までに当方ウェブサイト上への掲示や電子メール等の適切な方法で周知し、施行日以降は変更後の規約を本サービスに適用します。ユーザーが規約変更後も本サービスの利用を継続した場合、変更後の規約に同意したものとみなします。なお、本規約の変更によりユーザーに生じた不利益・損害について、当方は一切責任を負いません。

第10条（準拠法および合意管轄）
本規約の成立、履行、解釈にあたっては日本法が適用されます。本サービスに関連して当方とユーザーとの間で生じた紛争については、当方の所在地を管轄する裁判所を第一審の専属的合意管轄裁判所とします。
```

### スクロールエリアのCSS例

```css
.terms-scroll-box {
  height: 200px;
  overflow-y: auto;
  border: 1px solid #ccc;
  padding: 15px;
  background-color: #f9f9f9;
  font-size: 12px;
  line-height: 1.6;
  border-radius: 4px;
}
```

---

## 【同意チェックボックス】

- チェック必須
- 未チェック時はボタン無効化
- ページの中央に配置

**チェックボックスのラベル例:**
```
上記の免責事項および利用規約に同意します
```

---

## 【送信ボタン】

- ボタンテキスト: 「同意して始める」
- **中央配置**: ボタンはセクション内で水平方向に中央揃え
- 同意チェックボックスが未チェックの場合は無効化（disabled）

### ボタンのCSS例

```css
.submit-button-container {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}

.submit-button {
  padding: 12px 40px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}

.submit-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```

---

## 【スプレッドシート連携】（必須）

**⚠️ この機能は必須です。実装を忘れないこと。**

- **GAS URL**: `https://script.google.com/macros/s/AKfycbxpH8mJWk57MDoO5Q0rUdGzQ2GytKhKqjNm1i35j_sQaAFkky6Toi9WmQhG1DcIxWFmVA/exec`

- **送信データ形式**:
  | フィールド | 値 |
  |------------|-----|
  | age | 年齢範囲（0-10, 11-20, 21-30, 31-40, 41-50, 51-60, 61-70, 70+） |
  | gender | 性別（male, female, other, unknown） |
  | email | メールアドレス |
  | siteName | 「ツール名をここに入れる」 |

  **注意**: `registeredAt`（タイムスタンプ）はGAS側で記録するため、フロントからは送信不要。

- **エラーハンドリング**: エラー時もツール利用は継続可能にする

### GAS側の受信コード（重要）

**以下はGAS側のコードです。フロントエンドはこの形式に合わせてJSON形式で送信してください。**

```javascript
// GAS側（参照用）
function doPost(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    const data = JSON.parse(e.postData.contents);

    // GAS returns JST by default
    const now = new Date();

    sheet.appendRow([
      now,
      data.age || '',
      data.gender || '',
      data.email || '',
      data.siteName || '不明'
    ]);

    return ContentService.createTextOutput(JSON.stringify({
      result: 'success',
      message: 'Data saved'
    })).setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      result: 'error',
      message: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}
```

**重要**: GASの`new Date()`は既に日本時間（JST）を返すため、タイムゾーン変換処理は不要です。

### フロントエンド送信コード（これを使うこと）

```javascript
const sendToSpreadsheet = async (data) => {
  try {
    await fetch(GAS_URL, {
      method: 'POST',
      body: JSON.stringify(data)  // ← JSON形式で送信（必須）
    });
  } catch (error) {
    // エラーが発生してもツール利用は継続
    console.error('Registration data send failed (non-blocking)');
  }
};
```

**重要**:
- `Content-Type`ヘッダーや`no-cors`モードは**不要**
- GAS側がCORS対応済みのため、シンプルなfetchで動作する
- 必ず`JSON.stringify(data)`を使用すること（URLSearchParamsは使用しない）

### 送信タイミング
- ユーザーが「同意して始める」ボタンをクリックした直後
- 送信完了を待たずにメインツール画面へ遷移してOK（バックグラウンド送信）

### 注意点
- エラー時もツール利用は継続可能にすること
- 送信データはサニタイズ済みの値を使用すること

---

## 【画面フロー】

### 基本フロー
```
1. ユーザー登録画面（最初に必ず表示）
   ↓
2. フォーム入力 + 規約確認 + 同意チェック
   ↓
3. 「同意して始める」ボタンクリック
   ↓
4. スプレッドシートへデータ送信（バックグラウンド）
   ↓
5. メインツール画面へ遷移
```

### 実装上の注意点

- **初回アクセス時**: 必ずユーザー登録画面を表示する
- **登録済みユーザー**: localStorageで登録済みフラグを確認し、登録済みならメインツール画面へ直接遷移
- **登録スキップ不可**: 規約に同意しない限りツールは利用できない設計にする

### localStorage管理例

**重要**: ツールごとに異なるキー名を使用すること。

```javascript
// キー名はツールごとに変更すること（例: 6okuniki_mlm_registered, 6okuniki_lottery_registered）
const STORAGE_KEY = '6okuniki_ツール識別子_registered';
const STORAGE_KEY_AT = '6okuniki_ツール識別子_registered_at';

// 登録完了時に保存
localStorage.setItem(STORAGE_KEY, 'true');
localStorage.setItem(STORAGE_KEY_AT, new Date().toISOString());

// アクセス時に確認
const isRegistered = localStorage.getItem(STORAGE_KEY) === 'true';
if (isRegistered) {
  // メインツール画面を表示
} else {
  // ユーザー登録画面を表示
}
```

**キー名の例**:
- マルチ商法崩壊シミュレーター: `6okuniki_mlm_registered`
- 宝くじ当選シミュレーター: `6okuniki_lottery_registered`
- リボ払い地獄シミュレーター: `6okuniki_ribo_registered`

---

## 【デザイン要件】

1. **1画面収まり**: トップページ全体が1画面（スクロールなし）で収まるようにする
2. **利用規約部分のみスクロール**: 長文の利用規約は高さ固定のスクロールボックス内に収める
3. **中央配置**: フォームと同意チェックボックスはページ中央に配置
4. **レスポンシブ対応**: モバイルでも適切に表示されること
5. **ページ遷移時のスクロール位置**: 別途指定がない限り、ページ遷移時は常にページ最上部から表示する

### ページ最上部へのスクロール実装例

```javascript
// ページ遷移時に最上部へスクロール
window.scrollTo(0, 0);

// または React/Vue等のSPAの場合、ルート変更時に実行
// React Router例:
useEffect(() => {
  window.scrollTo(0, 0);
}, [location.pathname]);
```

---

## 【実装時の置換箇所】

ツールごとに以下を置き換えてください：

1. `「ツール名をここに入れる」` → 実際のツール名
2. 必要に応じてエンタメ免責の文言をツール内容に合わせて調整
