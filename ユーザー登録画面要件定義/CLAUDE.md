# CLAUDE.md - プロジェクト記憶ファイル

このファイルはClaude Codeがプロジェクトの重要な情報を自動記憶するためのファイルです。

---

## 実装時の必須確認事項

**重要**: このユーザー登録画面を実装する際は、必ず最初にユーザーに以下を確認すること：

1. **ツール名** - `siteName`フィールドに設定する値（例：「宝くじ当選シミュレーター」など）

ユーザーがツール名を伝えずに実装を依頼してきた場合は、実装を始める前に必ず聞き返すこと。

---

## 複数ファイルの取り扱い

このユーザー登録画面の要件定義は、各ツール固有の要件定義書と組み合わせて使用する。

- **本ファイル**: ユーザー登録画面の共通仕様
- **ツール要件定義書**: 各ツール固有の機能仕様

**重要**: 2つのファイルの内容が矛盾・衝突する場合は、勝手に判断せず必ずユーザーに確認してから進めること。

---

## 実装時の必須チェックリスト

**重要**: 以下の実装を絶対に忘れないこと。実装完了時に必ず確認すること。

- [ ] **スプレッドシート連携** - GAS URLへのPOST送信が実装されているか
  - age, gender, email, siteName を送信（registeredAtはGAS側で記録するため不要）
  - エラー時もツール利用は継続可能にする
  - **これは必須機能。忘れずに実装すること。**

---

## セキュリティ要件（必須）

**重要**: 6億ニキカテゴリのツールはインターネットに公開し一般ユーザーが利用するため、以下のセキュリティ対策を必ず実装すること。

### 入力バリデーション
- メールアドレス形式の厳格なバリデーション
- 全入力値のサニタイズ（HTMLエスケープ）
- 入力長の制限

### XSS対策
- ユーザー入力を画面表示する際は必ずエスケープ処理
- `innerHTML`の使用を避け、`textContent`を使用
- CSP（Content Security Policy）ヘッダーの設定を推奨

### CSRF対策
- フォーム送信時のトークン検証（可能な場合）

### その他
- HTTPS必須（本番環境）
- 外部APIへの送信データは最小限に
- エラーメッセージに内部情報を含めない
- console.logにセンシティブな情報を出力しない

---

## プロジェクト概要

- **プロジェクト名**: 6億ニキ ユーザー登録画面共通仕様
- **目的**: 6億ニキカテゴリの複数ツールで共通利用するユーザー登録画面の要件定義

---

## 重要な決定事項

### 画面フロー
- 最初のページは必ずユーザー登録画面
- 規約に同意後、メインツール画面へ遷移
- 登録済みユーザーはlocalStorageで判定してスキップ

### 免責事項・利用規約の表示順序
1. **エンタメ免責**（最初に表示）- ツールはエンタメ目的、結果に責任を持たない
2. **利用規約**（スクロールボックス内）- 第1条〜第10条の詳細規約

### 利用規約のポリシー
- 元の「株式会社ネオビジョンテックス」の規約に準拠
- 会社名は「当方」に置換
- 内容はほぼ全文維持（簡潔にまとめない方針）
- スクロール可能なボックス（高さ200px程度）に収める

### デザイン要件
- トップページ全体は1画面（スクロールなし）で収まるようにする
- 利用規約部分のみスクロール
- フォームと同意チェックボックスはページ中央配置
- レスポンシブ対応

---

## 技術スタック・連携先

### スプレッドシート連携
- **GAS URL**: `https://script.google.com/macros/s/AKfycbxpH8mJWk57MDoO5Q0rUdGzQ2GytKhKqjNm1i35j_sQaAFkky6Toi9WmQhG1DcIxWFmVA/exec`
- エラー時もツール利用は継続可能にする

### 送信データ形式
| フィールド | 値 |
|------------|-----|
| age | 年齢範囲（0-10, 11-20, 21-30, 31-40, 41-50, 51-60, 61-70, 70+） |
| gender | 性別（male, female, other, unknown） |
| email | メールアドレス |
| siteName | ツール名 |

**注意**: `registeredAt`（タイムスタンプ）はGAS側で記録するため、フロントからは送信不要。GASの`new Date()`は既に日本時間を返すため、タイムゾーン変換処理は不要。

---

## ファイル構成

- `6oku-niki-registration-script.md` - 実装指示スクリプト本体

---

## 更新履歴

- 2025-12-08: タイムスタンプ仕様修正
  - `registeredAt`をフロントから送信せず、GAS側で記録する方式に変更
  - GASの`new Date()`は既に日本時間を返すため、タイムゾーン変換処理は不要であることを明記
  - localStorageのキー名をツールごとに異なるものを使用するよう明記

- 2025-12-02: 初版作成
  - 登録フォーム仕様確定
  - 免責事項・利用規約の表示順序確定（エンタメ免責 → メルマガ規約）
  - 利用規約は詳細版を維持しスクロールボックスで表示
  - 画面フロー確定（登録画面 → 同意 → ツール画面）
